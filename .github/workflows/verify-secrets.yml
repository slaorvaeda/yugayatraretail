name: Verify GitHub Secrets

on:
  workflow_dispatch:

jobs:
  verify-secrets:
    name: Verify Secrets
    runs-on: ubuntu-latest
    steps:
      - name: Check GCP_SA_KEY
        run: |
          if [ -z "${{ secrets.GCP_SA_KEY }}" ]; then
            echo "❌ GCP_SA_KEY is NOT SET"
            exit 1
          else
            LENGTH=$(echo "${{ secrets.GCP_SA_KEY }}" | wc -c)
            echo "✅ GCP_SA_KEY is SET (length: $LENGTH chars)"
            # Try to parse as JSON to verify it's valid
            echo "${{ secrets.GCP_SA_KEY }}" | jq -e . > /dev/null 2>&1
            if [ $? -eq 0 ]; then
              echo "✅ GCP_SA_KEY is valid JSON"
              PROJECT_ID=$(echo "${{ secrets.GCP_SA_KEY }}" | jq -r '.project_id // empty')
              CLIENT_EMAIL=$(echo "${{ secrets.GCP_SA_KEY }}" | jq -r '.client_email // empty')
              echo "   Project ID: $PROJECT_ID"
              echo "   Client Email: $CLIENT_EMAIL"
            else
              echo "⚠️  GCP_SA_KEY might not be valid JSON"
            fi
          fi
        env:
          GCP_SA_KEY_VALUE: ${{ secrets.GCP_SA_KEY }}

      - name: Check Optional Secrets
        run: |
          echo "=========================================="
          echo "Checking Optional Secrets (with defaults)"
          echo "=========================================="
          
          # Check GCP_REGION
          GCP_REGION="${{ secrets.GCP_REGION }}"
          if [ -z "$GCP_REGION" ] || [ "$GCP_REGION" = "" ]; then
            echo "⚠️  GCP_REGION: Not set (will use default: us-central1)"
          else
            echo "✅ GCP_REGION: $GCP_REGION"
          fi
          
          # Check GCP_PROJECT_ID
          GCP_PROJECT_ID="${{ secrets.GCP_PROJECT_ID }}"
          if [ -z "$GCP_PROJECT_ID" ] || [ "$GCP_PROJECT_ID" = "" ]; then
            echo "⚠️  GCP_PROJECT_ID: Not set (will use default: yugayatraretail)"
          else
            echo "✅ GCP_PROJECT_ID: $GCP_PROJECT_ID"
          fi
          
          # Check GCP_ARTIFACT_REGISTRY
          GCP_ARTIFACT_REGISTRY="${{ secrets.GCP_ARTIFACT_REGISTRY }}"
          if [ -z "$GCP_ARTIFACT_REGISTRY" ] || [ "$GCP_ARTIFACT_REGISTRY" = "" ]; then
            echo "⚠️  GCP_ARTIFACT_REGISTRY: Not set (will use default: yugayatraretail)"
          else
            echo "✅ GCP_ARTIFACT_REGISTRY: $GCP_ARTIFACT_REGISTRY"
          fi
          
          echo "=========================================="
          echo "✅ Secret verification complete!"
          echo "=========================================="

